
## 1. 事务可能的问题
```
* 脏写
    1. 事务一更新数据, 还未提交
    2. 事务二更新相同数据, 提交
    3. 事务一提交, 此时, 事务一覆盖了事务二的数据
* 脏读
    1. 事务一更新数据, 还未提交
    2. 事务二读取到更新过的数据
    3. 事务一回滚, 此时, 事务二读取的数据就是脏的
* 不可重复读
    1. 事务一读取数据
    2. 会话B 更新相关数据
    3. 事务一再次读取数据, 数据不一致
* 幻读
    1. 事务一读取数据
    2. 会话B 插入一些数据
    3. 事务一再次读取数据, 比之前多 
* 严重性: 脏写 > 脏读 > 不可重复读 > 幻读
```

## 2. 四种隔离级别
```
* READ UNCOMMITTED
    * 可以看到其他未提交事务的执行结果
    * 不能避免脏读、不可重复读、幻读 
* READ COMMITTED
    * 只能看见已经提交事务所做的改变
    * 可以避免脏读，但不可重复读、幻读问题仍然存在
* REPEATABLE READ: 可重复读
    * 事务A在读到一条数据之后，此时事务B对该数据进行了修改并提交
    * 那么事务A再读该数据，读到的还是原来的内容
    * 可以避免脏读、不可重复读，但幻读问题仍然存在 (MySQL 可以处理幻读)
    * 这是 MySQL 的默认隔离级别
* SERIALIZABLE: 可串行化，确保事务可以从一个表中读取相同的行
    * 事务持续期间，禁止其他事务对该表执行插入、更新和删除操作
    * 性能十分低下
    * 能避免脏读、不可重复读和幻读

SELECT  @@GLOBAL.TRANSACTION_ISOLATION; # 查看隔离级别
SELECT @@SESSION.TRANSACTION_ISOLATION; # 查看隔离级别

SET GLOBAL TRANSACTION_ISOLATION = 'RREAD-UNCOMMITTED'; # 设置隔离级别
SET GLOBAL TRANSACTION_ISOLATION = 'READ-COMMITTED';    # 设置隔离级别
SET GLOBAL TRANSACTION_ISOLATION = 'REPEATABLE-READ';   # 设置隔离级别
SET GLOBAL TRANSACTION_ISOLATION = 'SERIALIZABLE';      # 设置隔离级别

SET SESSION TRANSACTION_ISOLATION = 'RREAD-UNCOMMITTED'; # 设置隔离级别
SET SESSION TRANSACTION_ISOLATION = 'READ-COMMITTED';    # 设置隔离级别
SET SESSION TRANSACTION_ISOLATION = 'REPEATABLE-READ';   # 设置隔离级别
SET SESSION TRANSACTION_ISOLATION = 'SERIALIZABLE';      # 设置隔离级别
```

## 3. 测试
```
# 3.1 测试 READ UNCOMMITTED
TRUNCATE student;                   #  1. 清空表
START TRANSACTION;                  #  2. 开启事务
INSERT INTO student VALUES('张三'); #  3. 不提交
SELECT * FROM student;              #  4. 当前事务: 张三
SET SESSION TRANSACTION_ISOLATION = 'RREAD-UNCOMMITTED';
                                    #  5. 其他会话中执行, 设置隔离级别
SELECT * FROM student;              #  6. 其他会话: 张三, 可以读取到未提交的数据
ROLLBACK;                           #  7. 回滚
SELECT * FROM student;              #  8. 当前事务: 空表
SELECT * FROM student;              #  9. 其他会话: 空表, 之前读取的 张三 数据是脏数据
COMMIT;                             # 10. 提交事务
SELECT * FROM student;              # 11. 当前会话: 空表
SELECT * FROM student;              # 12. 其他会话: 空表


# 3.2 测试 READ COMMITTED

# 3.3 REPEATABLE READ

# 3.4 SERIALIZABLE
```

