
## 事务日志
```
# 1. redo log
* 记录的是 物理操作
* 为了实现持久性和效率的平衡
* 落盘: 内存中的文件存入磁盘
* 事务完成前, 把所有修改的页落盘 (修改量和落盘量不成比例, 随机 IO 效率低)
* 事务完成前, 只把修改的内容的日志落盘 (顺序 IO 效率高, 占用空间小, 降低刷盘的频率)
* Write-Ahead Logging: 先写日志(此时, 可以完成事务了), 再写磁盘(定期写入即可)
* 事务执行过程中就会 redo log
* innodb_flush_log_at_trx_commit = 0
    * 提交事务成功, 保证将 redo log 写入 MySQL 缓冲区
    * 主线程 刷新缓冲区, 每一秒落盘
    * MySQL 崩溃了, 可能会丢失数据
    * 操作系统崩溃了, 可能丢失数据
* innodb_flush_log_at_trx_commit = 1 (默认)
    * 提交事务成功, 保证将 redo log 写入内核缓冲区, 同时刷盘
    * MySQL 崩溃了, 不会丢失数据
    * 操作系统崩溃了, 不会丢失数据
* innodb_flush_log_at_trx_commit = 2 
    * 提交事务成功, 保证将 redo log 写入内核缓冲区
    * 主线程每一秒落盘
    * MySQL 崩溃了, 不会丢失数据
    * 操作系统崩溃了, 可能丢失数据

# 2. undo log
* 记录的是 逻辑操作
* 比如 执行 INSERT 操作, 就记录一条 DELETE 操作
* 用于事务的回滚
```
