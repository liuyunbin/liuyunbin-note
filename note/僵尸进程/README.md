
# 僵尸进程
## 僵尸进程产生的原因
子进程已退出, 父进程未处理

## 僵尸进程存在的意义
父进程可以获取子进程退出的状态信息

## 产生僵尸进程的场景
### 子进程已退出, 父进程未处理
1. 父进程设置信号 `SIGCHLD` 的处理方式为 `SIG_DFL`
2. 父进程阻塞信号 `SIGCHLD`
3. 父进程产生五个子进程, 每次子进程都退出, 父进程休眠一秒, 保证子进程已退出
4. 父进程解除信号 `SIGCHLD` 阻塞
5. 此时, 所有的子进程都处于僵尸状态

### 子进程已退出, 父进程已处理, 但处理方式不对, 导致产生了僵尸进程
1. 父进程设置捕捉 `SIGCHLD`, 信号处理函数调用一次 `waitpid()`
2. 父进程阻塞信号 `SIGCHLD`
3. 父进程产生五个子进程, 每次子进程都退出, 父进程休眠一秒, 保证子进程已退出
4. 父进程解除信号 `SIGCHLD` 阻塞
5. 此时, 由于有的 `SIGCHLD` 信号丢失, 有的子进程处于僵尸状态

## 预防僵尸进程的产生
1. 父进程设置 `SIGCHLD` 的信号处理函数时, 信号处理函数里循环调用 `waitpid(...WNOHANG)`
2. 父进程设置 `SIGCHLD` 的信号处理函数时, 使用 `SIG_IGN` 忽略信号 `SIGCHLD`
3. 父进程设置 `SIGCHLD` 的信号处理函数时, 使用 `sigaction(...SA_NOCLDWAIT)` 设置不产生僵尸进程
4. 父进程退出, 直接将对子进程的处理行为交给 `systemd`, 这个不建议

## 处理僵尸进程
1. 只能杀死僵尸进程的父进程
2. 此后, 僵尸进程的父进程将变为 `systemd`
3. 此后, `systemd` 将处理 `SIGCHLD` 信号
4. 然后, 僵尸进程消失

